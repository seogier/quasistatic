# Quasi-magnetostatic EM Solver

This solver uses the Biot-Savart Law to implement a quasi-magnetostatic solver for the magnetic fields produced by a wire structure.

This solver makes the following assumptions:
 - The coil is a single infintessimally thin wire path
 - The current is a uniform 1 A
 - All distance units are in meters

This solver produces an exact solution for the input coil - the only approximation (beyond the quasi-magnetostatic approximation) is in the discritization of the coil itself.

Further details on the theory and implementation of the solver are in `Quasi.docx`.

## Usage

The quasistatic solver is implemented using an object-oriented approach. `quasistatic.py` contains three classes designed to make simulation easy and clean.

- Coil - the coil to simulate
- Grid - a rectiliniar sampling grid for results
- Result - simulation results

A basic simulation might look like the following:
```python
from quasistatic import Coil, Grid, Result # Import main classes
test = Coil.from_csv('test_coil.csv') # Load test coil in format specified below.
plane = Grid.evenly_spaced_3D([-.1, .1], .01, [-.1, .1], .01, .01, 0) # Define sampling pattern
result = test.compute(plane)
```

### Coil
A Coil object (`c`) contains the array of points that define the coil, as well as functions to plot the coil and perform the quasistatic simulation.

A Coil object can be generated from a N X 3 array of points (`c = Coil(points)`), but a more common use case is loading the list of points from a `.csv` file (in the format specified below) with `c = Coil.from_csv(coil.csv)`

`c.plot_coil()` generates a 3D plot of the coil's wire structure, with points marking the ends of the wire segments

`c.compute(Grid)` performs the quasistatic simulation of the coil at each point in the input Grid and returns a Result object.

### Grid
A Grid object (`g`) is a rectilinear grid of points. Each axis has 1 or more points, which need not be evenly spaced.

`g.points()` returns all of the points in the grid reshaped into a [Nx * Ny * Nz, 3] array.

`g.shape` is the [Nx, Ny, Nz] shape of the grid

A Grid can be generated with `g = Grid(Xz, Ys, Zs)`, in which lists of points are supplied for each axis, or with the following method:

- `g = Grid.evenly_spaced_3D(X_range, dX, Y_range, dY, Z_range, dZ)` generates a Grid with points evenly spaced along each axis. The range and spacing of each axis is specified. If a single value is given instead of a range, or dX/dY/dZ = 0, then that dimension of the grid will only have one value

### Result
A Result object (`r`) is a subclass of `Grid` and contains a grid and the results of a coil simulated on that grid.
For the end user, `r` will most commonly be generated by `r = c.compute(g)`, but it can also be generated in the following ways:
- `r = Result(g, values)` where if `g` has shape [Nx, Ny, Nz] then `values` is a [Nx, Ny, Nz, 3] array.
- `r = Result.from_1D(g, values)` where if `g` has shape [Nx, Ny, NZ] then `values` is a [Nx * Ny * Nz, 3] array.

It has the following useful properties:
- `g.B1_mag` - Magnitude of XY components of results
- `g.B1_phase` - Phase of XY components of results
    
## File Formats
### Coil
The coil is a CSV file of (x,y,z) coordinates with the following format:

| X   | Y   | Z   |
|-----|-----|-----|
| x0  | y0  | z0  |
| x1  | y1  | z1  |
| ... | ... | ... |
| xN  | yN  | zN  |

Each wire segment is a straight line between (x_n, y_n, z_n) and (x_n+1, y_n+1, z_n+1).

The coil definition makes the present assumptions:
 - The coil has a constant current of 1.0 A
 - The coil is a single continuous wire from the (x0, y0, z0) to (xN, yN, zN)

If a closed loop is desired, the last point must be the same as the first.

## Included tools
### `basic_coils.py`
This is useful for generating test coils that are either loops (in or parallel to the XY plane) or straight wires (along the Z axis).

<details>
<summary>Usage</summary>

`python basic_coils.py [shape] [save_name] --radius [rad] --length [len] --segments [seg] --z-offset [zof]`

Parameters:
- `shape` Shape of coil: `circ_loop` or `line`
- `save_name` Filename to save as. If none is supplied, a name based on the coil type and dimensions will be used.
- `-r --radius` Radius of loop in m - only applies to circular loop
- `-l --length` Length of line in m - only applies to line
- `-s --segments` Number of segments to discritize coil into
- `-z --z-offset` Z offset of coil from XY plane - only applies to circular loop
</details>